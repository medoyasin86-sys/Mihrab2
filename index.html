<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù„ØªÙ‚ÙŠ Ø¹Ù„Ù‰ Ø·Ø§Ø¹Ø© Ø§Ù„Ù„Ù‡ 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.4/dist/index.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --royal-green: #00332c; 
            --masjid: #004d40; 
            --gold-gradient: linear-gradient(135deg, #d4af37 0%, #f1d37e 50%, #b8860b 100%);
            --deep-gold: #b8860b;
            --bg: #fcfaf5; 
            --text: #1a252f; 
            --card-bg: #ffffff;
            --border: #eee;
        }

        body.dark-mode {
            --bg: #121212; --text: #e0e0e0; --card-bg: #1e1e1e; --border: #333; --masjid: #4db6ac; --royal-green: #004d40;
        }
        
        body { font-family: 'Amiri', serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; transition: 0.3s; }
        .container { max-width: 900px; margin: auto; background: var(--card-bg); border-radius: 30px; padding: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.08); }
        
        /* Ø´Ø±ÙŠØ· ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙŠØ§Ù… */
        .fasting-alert-bar { 
            background: var(--gold-gradient); color: var(--royal-green); padding: 12px; text-align: center; 
            border-radius: 15px; margin-bottom: 15px; font-weight: bold; animation: pulse-gold 2s infinite; display: none;
        }
        @keyframes pulse-gold { 0% {transform: scale(1);} 50% {transform: scale(1.02);} 100% {transform: scale(1);} }

        /* Ø§Ù„Ø´Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± */
        .chat-section { background: var(--card-bg); border: 2px solid var(--masjid); border-radius: 25px; padding: 15px; margin-top: 30px; }
        .chat-box { height: 250px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; margin-bottom: 10px; border-radius: 15px; background: rgba(0,0,0,0.02); }
        .chat-controls { display: flex; gap: 8px; align-items: center; background: var(--border); padding: 8px; border-radius: 15px; }
        .chat-btn-icon { background: none; border: none; font-size: 1.4rem; cursor: pointer; padding: 5px; }
        #chat-input { flex: 1; border: none; padding: 8px; border-radius: 10px; outline: none; background: var(--card-bg); color: var(--text); }
        
        /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .fajr-crown { color: #d4af37; font-size: 1.2rem; margin-left: 4px; filter: drop-shadow(0 0 2px gold); }
        .active-fajr-m { 
            background: #d32f2f !important; color: white !important; 
            border: 2px solid gold !important; position: relative; box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .msg-img { max-width: 150px; border-radius: 10px; margin-top: 5px; display: block; }
        .btn-group button { min-width: 55px; height: 45px; cursor: pointer; border-radius: 10px; border: 1px solid var(--border); font-family: 'Amiri'; }
        .active-m { background: var(--masjid); color: white; }
    </style>
</head>
<body>

<div class="container">
    <div id="ramadan-countdown" class="fasting-alert-bar" style="display:block; margin-bottom:10px;">â³ Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø±Ù…Ø¶Ø§Ù†...</div>
    <div id="fasting-tomorrow-alert" class="fasting-alert-bar">âœ¨ ØºØ¯Ø§Ù‹ ÙŠÙˆÙ… ØµÙŠØ§Ù… Ù…Ø¨Ø§Ø±Ùƒ.. Ù†Ù„ØªÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­ÙˆØ± ÙˆØ§Ù„Ù†ÙŠØ© Ø§Ù„Ø®Ø§Ù„ØµØ©!</div>

    <div style="text-align:center;">
        <h1 style="font-family:'Reem Kufi'; color: var(--royal-green);">âšœï¸ Ù†Ù„ØªÙ‚ÙŠ Ø¹Ù„Ù‰ Ø·Ø§Ø¹Ø© Ø§Ù„Ù„Ù‡ 2026</h1>
        <div id="hijri-date" style="color:var(--deep-gold); font-weight:bold; font-size: 1.2rem;"></div>
        <input type="date" id="main-date" style="padding:8px; border-radius:12px; margin:10px;">
    </div>

    <div id="app-body">
        <div class="task-card" style="padding:15px; border-right: 8px solid var(--masjid); background:#f9f9f9; border-radius:15px; margin-bottom:15px;">
            <h3 style="color:var(--masjid)">ğŸ•‹ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</h3>
            <div id="fard-list"></div>
        </div>
        </div>

    <div class="chat-section">
        <h3 style="text-align:center; font-family:'Reem Kufi'; color:var(--masjid);">ğŸ’¬ Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù…Ø·ÙˆØ±</h3>
        <div id="chat-box" class="chat-box"></div>
        
        <div class="chat-controls">
            <select id="chat-user-select" style="padding:5px; border-radius:8px;">
                <option value="">ğŸ‘¤</option>
                <option value="Ù…Ø­Ù…Ø¯">Ù…Ø­Ù…Ø¯</option><option value="Ø´ÙŠÙ…Ø§Ø¡">Ø´ÙŠÙ…Ø§Ø¡</option>
                <option value="Ø£Ø­Ù…Ø¯">Ø£Ø­Ù…Ø¯</option><option value="ÙŠØ§Ø³ÙŠÙ†">ÙŠØ§Ø³ÙŠÙ†</option>
            </select>
            
            <button class="chat-btn-icon" id="emoji-btn" title="Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">ğŸ˜Š</button>
            <button class="chat-btn-icon" onclick="document.getElementById('file-input').click()" title="Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø©">ğŸ“</button>
            <input type="file" id="file-input" style="display:none" accept="image/*" onchange="uploadImage(this)">
            
            <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
            <button onclick="sendMsg()" style="background:var(--masjid); color:white; border:none; padding:8px 15px; border-radius:10px; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase (Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1", storageBucket: "ebada-656e1.firebasestorage.app", messagingSenderId: "705608653939", appId: "1:705608653939:web:5ab3609a6f7ccc8675de06" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    const prayers = [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±', icon:'ğŸŒ…'},{id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±', icon:'â˜€ï¸'},{id:'asr', n:'Ø§Ù„Ø¹ØµØ±', icon:'ğŸŒ¤ï¸'},{id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨', icon:'ğŸŒ‡'},{id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡', icon:'ğŸŒƒ'}];

    // ØªÙØ¹ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    const picker = new EmojiButton({ position: 'top-start' });
    const emojiBtn = document.querySelector('#emoji-btn');
    picker.on('emoji', selection => { document.querySelector('#chat-input').value += selection; });
    emojiBtn.addEventListener('click', () => picker.togglePicker(emojiBtn));

    // ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function sendMsg() {
        const user = document.getElementById('chat-user-select').value;
        const txt = document.getElementById('chat-input').value;
        if(!user) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
        if(!txt) return;

        db.ref('osraty_chat').push({
            user: user,
            msg: txt,
            type: 'text',
            time: new Date().toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'})
        });
        document.getElementById('chat-input').value = '';
    }

    // ÙˆØ¸ÙŠÙØ© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± (Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ùˆ Ø¹Ø¨Ø± Firebase Storage Ø¥Ø°Ø§ ÙØ¹Ù„ØªÙ‡)
    function uploadImage(input) {
        const user = document.getElementById('chat-user-select').value;
        if(!user) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
        
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                db.ref('osraty_chat').push({
                    user: user,
                    img: e.target.result,
                    type: 'image',
                    time: new Date().toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'})
                });
            };
            reader.readAsDataURL(file);
        }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    db.ref('osraty_chat').limitToLast(20).on('value', snap => {
        const box = document.getElementById('chat-box');
        box.innerHTML = '';
        snap.forEach(child => {
            const d = child.val();
            let content = d.type === 'image' ? `<img src="${d.img}" class="msg-img">` : `<div>${d.msg}</div>`;
            box.innerHTML += `<div style="margin-bottom:10px; padding:8px; border-right:3px solid var(--masjid); background:white; border-radius:10px;">
                <small style="color:gray;">${d.user} â€¢ ${d.time}</small>${content}
            </div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„ÙˆØ§Øª Ù…Ø¹ Ù…ÙŠØ²Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø©
    function renderPrayers(ud) {
        document.getElementById('fard-list').innerHTML = prayers.map(p => {
            const v = ud[p.id]?.type || '';
            const isFajr = p.id === 'fajr';
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø¬ Ù„Ù„ÙØ¬Ø±
            const fajrBadge = (isFajr && v === 'm') ? '<span class="fajr-crown">ğŸ‘‘</span>' : '';
            
            return `<div style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #eee;">
                <span>${p.icon} ${p.n} ${fajrBadge}</span>
                <div class="btn-group">
                    <button class="${v==='m' ? (isFajr ? 'active-fajr-m' : 'active-m') : ''}" onclick="saveTask('${p.id}','m',100)">
                        ${isFajr ? 'â­ ' : ''}Ù…Ø³Ø¬Ø¯
                    </button>
                    <button class="${v==='h'?'active-m':''}" onclick="saveTask('${p.id}','h',50)">Ø¬Ù…Ø§Ø¹Ø©</button>
                    <button class="${v==='s'?'active-m':''}" onclick="saveTask('${p.id}','s',25)">ÙØ±Ø¯ÙŠ</button>
                </div>
            </div>`;
        }).join('');
    }

    function saveTask(id, type, p) {
        const date = document.getElementById('main-date').value;
        const user = document.getElementById('chat-user-select').value;
        if(!user) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ!");
        db.ref(`osraty/${date}/${user}/${id}`).set({type, p});
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    function init() {
        document.getElementById('main-date').value = new Date().toISOString().split('T')[0];
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('osraty').on('value', snap => {
            const date = document.getElementById('main-date').value;
            const user = document.getElementById('chat-user-select').value;
            if(user) renderPrayers(snap.val()?.[date]?.[user] || {});
        });
        
        // Ø¹Ø¯Ø§Ø¯ Ø±Ù…Ø¶Ø§Ù†
        const diff = new Date("2026-02-18") - new Date();
        document.getElementById('ramadan-countdown').innerText = `â³ Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ù†ÙØ­Ø§Øª Ø±Ù…Ø¶Ø§Ù†: ${Math.floor(diff/(1000*60*60*24))} ÙŠÙˆÙ…`;
    }

    init();
    document.getElementById('chat-user-select').onchange = () => {
        const user = document.getElementById('chat-user-select').value;
        if(user) db.ref('osraty').once('value', snap => {
             const date = document.getElementById('main-date').value;
             renderPrayers(snap.val()?.[date]?.[user] || {});
        });
    };
</script>

</body>
</html>
