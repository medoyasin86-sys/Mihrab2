<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø§Ø¨ Ø±Ù…Ø¶Ø§Ù† 2026 - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --teal: #00695c; --gold: #d4af37; --light-gold: #f9f1d7; --accent: #c62828; --bg-gradient: linear-gradient(135deg, #e0f2f1 0%, #f1f8e9 100%); }
        body { font-family: 'Amiri', serif; background: var(--bg-gradient); color: #2c3e50; margin: 0; padding: 10px; }
        .main-container { max-width: 900px; margin: auto; background: rgba(255,255,255,0.95); border-radius: 30px; padding: 25px; box-shadow: 0 20px 50px rgba(0,105,92,0.15); border: 1px solid var(--gold); }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header-section { text-align: center; border-bottom: 3px double var(--gold); padding-bottom: 15px; margin-bottom: 25px; }
        .header-title { font-family: 'Reem Kufi'; color: var(--teal); font-size: 2.5rem; margin: 0; }
        
        /* Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Øª */
        .timer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .city-card { background: white; border: 2px solid var(--gold); border-radius: 20px; padding: 15px; position: relative; overflow: hidden; }
        .city-card::before { content: "ğŸŒ™"; position: absolute; left: -10px; top: -10px; opacity: 0.1; font-size: 4rem; }
        .city-name { color: var(--teal); font-weight: bold; font-size: 1.2rem; }
        .prayer-label { font-size: 0.9rem; color: var(--accent); display: block; margin-top: 5px; }
        .countdown { font-family: sans-serif; font-size: 1.5rem; font-weight: bold; color: #333; }

        /* Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© */
        .imsakiya-box { background: var(--light-gold); border-radius: 20px; padding: 20px; margin-bottom: 25px; border: 1px solid var(--gold); }
        .imsakiya-table { width: 100%; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
        .imsakiya-table th { background: var(--teal); color: white; padding: 12px; font-size: 0.9rem; }
        .imsakiya-table td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        .row-salalah { color: var(--teal); font-weight: bold; }
        .row-kafr { color: #555; }

        /* Ø®Ø§ØµÙŠØ© Ø§Ù„Ø¬Ù…Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ© */
        #friday-card { display: none; background: linear-gradient(45deg, #004d40, #00695c); color: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center; }

        /* Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ù…Ù‡Ø§Ù… */
        .task-card { background: white; border: 1px solid #ddd; border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        .habit-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed #eee; }
        .points-badge { background: var(--gold); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
        
        .comp-card { background: white; border: 2px solid #eee; border-radius: 20px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; }
        .comp-card.active { border-color: var(--teal); background: #e0f2f1; transform: scale(1.02); }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-section">
        <h1 class="header-title">ğŸŒ™ Ù…Ø­Ø±Ø§Ø¨ Ø¹Ø§Ø¦Ù„ØªÙŠ 2026</h1>
        <div id="hijri-display" style="color: var(--gold); font-weight: bold; margin: 10px 0;"></div>
        <input type="date" id="date-picker" style="border: 1px solid var(--gold); padding: 5px; border-radius: 10px;">
    </div>

    <div id="friday-card">
        <h3 style="margin:0">ğŸ•Œ Ø®ÙŠØ±Ù ÙŠÙˆÙ…Ù Ø·Ù„Ø¹Øª ÙÙŠÙ‡ Ø§Ù„Ø´Ù…Ø³ (Ø§Ù„Ø¬Ù…Ø¹Ø©)</h3>
        <p style="font-size:0.9rem; margin:5px 0;">Ù„Ø§ ØªÙ†Ø³Ù Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡ÙØŒ Ø§Ù„ØºØ³Ù„ØŒ ÙˆÙƒØ«Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º</p>
    </div>

    <div class="timer-grid">
        <div class="city-card">
            <span class="city-name">ğŸ‡´ğŸ‡² ØµÙ„Ø§Ù„Ø©</span>
            <span id="label-salalah" class="prayer-label">--</span>
            <div id="time-salalah" class="countdown">00:00:00</div>
        </div>
        <div class="city-card">
            <span class="city-name">ğŸ‡ªğŸ‡¬ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</span>
            <span id="label-kafr" class="prayer-label">--</span>
            <div id="time-kafr" class="countdown">00:00:00</div>
        </div>
    </div>

    <div class="imsakiya-box">
        <h3 style="text-align:center; color: var(--teal); margin-top:0;">ğŸ“… Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„ÙŠÙˆÙ…</h3>
        <div style="overflow-x: auto;">
            <table class="imsakiya-table">
                <thead>
                    <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ÙØ¬Ø±</th><th>Ø§Ù„Ø´Ø±ÙˆÙ‚</th><th>Ø§Ù„Ø¸Ù‡Ø±</th><th>Ø§Ù„Ø¹ØµØ±</th><th>Ø§Ù„Ù…ØºØ±Ø¨</th><th>Ø§Ù„Ø¹Ø´Ø§Ø¡</th></tr>
                </thead>
                <tbody id="imsakiya-body">
                    <tr class="row-salalah"><td>ØµÙ„Ø§Ù„Ø©</td><td>05:12</td><td>06:28</td><td>12:34</td><td>15:54</td><td>18:22</td><td>19:38</td></tr>
                    <tr class="row-kafr"><td>ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</td><td>05:02</td><td>06:30</td><td>12:12</td><td>15:14</td><td>17:54</td><td>19:16</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="cards-ui" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;"></div>

    <div id="user-ui" style="display:none;">
        <div class="task-card" style="border-left: 8px solid var(--gold);">
            <h3>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… (Ø§Ù„Ø®ØªÙ…Ø©)</h3>
            <div style="display:flex; justify-content:space-between;">
                <span>Ø£ÙŠÙ† ÙˆØµÙ„Øª Ø§Ù„ÙŠÙˆÙ…ØŸ (Ø±Ù‚Ù… Ø§Ù„Ø¬Ø²Ø¡)</span>
                <input type="number" id="quran-part" min="0" max="30" onchange="saveKhatma(this.value)" style="width:60px; padding:5px; border-radius:10px; border:1px solid var(--gold);">
            </div>
            <div style="background:#eee; height:12px; border-radius:10px; margin-top:10px; overflow:hidden;">
                <div id="khatma-progress" style="background:var(--teal); height:100%; width:0%; transition: 0.5s;"></div>
            </div>
        </div>

        <div class="task-card">
            <h3>ğŸ•‹ Ø§Ù„ØµÙ„ÙˆØ§Øª ÙˆØ§Ù„Ø³Ù†Ù†</h3>
            <div id="fard-list"></div>
            <h4 style="color:var(--gold); border-bottom:1px solid #eee; padding-bottom:5px;">âœ¨ Ø§Ù„Ø³Ù†Ù† Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù†ÙˆØ§ÙÙ„</h4>
            <div id="sunan-list"></div>
        </div>
        
        <div class="task-card">
            <h3>ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h3>
            <div id="chat-box" style="height:100px; overflow-y:auto; border:1px solid #eee; padding:10px; border-radius:10px; margin-bottom:10px;"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="chat-in" style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;">
                <button onclick="sendMsg()" style="background:var(--teal); color:white; border:none; padding:8px 15px; border-radius:8px;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1", storageBucket: "ebada-656e1.firebasestorage.app", messagingSenderId: "705608653939", appId: "1:705608653939:web:5ab3609a6f7ccc8675de06" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();
    let currentUser = null; const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];
    
    // Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
    const PRAYERS = {
        salalah: { n: ['Ø§Ù„ÙØ¬Ø±','Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨','Ø§Ù„Ø¹Ø´Ø§Ø¡'], t: [[5,12],[12,34],[15,54],[18,22],[19,38]] },
        kafr: { n: ['Ø§Ù„ÙØ¬Ø±','Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨','Ø§Ù„Ø¹Ø´Ø§Ø¡'], t: [[5,2],[12,12],[15,14],[17,54],[19,16]] }
    };

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù†Ù†
    const sunanModel = [
        {id:'s_fajr', n:'Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø± (Ø±ÙƒØ¹ØªØ§Ù†)', p:15},
        {id:'s_dhuhr', n:'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø± (4 Ù‚Ø¨Ù„ Ùˆ 2 Ø¨Ø¹Ø¯)', p:25},
        {id:'s_asr', n:'Ø³Ù†Ø© Ø§Ù„Ø¹ØµØ± (4 Ù‚Ø¨Ù„ÙŠØ©)', p:10},
        {id:'s_maghrib', n:'Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨ (2 Ø¨Ø¹Ø¯ÙŠØ©)', p:15},
        {id:'s_isha', n:'Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ ÙˆØ§Ù„ÙˆØªØ±', p:30},
        {id:'duha', n:'ØµÙ„Ø§Ø© Ø§Ù„Ø¶Ø­Ù‰', p:20},
        {id:'traweeh', n:'Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ ÙˆØ§Ù„Ù‚ÙŠØ§Ù…', p:60}
    ];

    function updateApp() {
        const dStr = document.getElementById('date-picker').value;
        const dObj = new Date(dStr);
        
        // Ø®Ø§ØµÙŠØ© Ø§Ù„Ø¬Ù…Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ©
        document.getElementById('friday-card').style.display = (dObj.getDay() === 5) ? 'block' : 'none';
        
        document.getElementById('hijri-display').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(dObj);
        
        db.ref('osraty/' + dStr).on('value', snap => render(snap.val() || {}));
        db.ref('chat/' + dStr).on('value', snap => {
            const m = snap.val() || [];
            document.getElementById('chat-box').innerHTML = m.map(x => `<div><b>${x.u}:</b> ${x.t}</div>`).join('');
            document.getElementById('chat-box').scrollTop = 999;
        });
    }

    function updateTimers() {
        const now = new Date();
        const offsetEgypt = -2; // ÙØ§Ø±Ù‚ Ø§Ù„ØªÙˆÙ‚ÙŠØª
        
        updateCityTimer('salalah', now);
        updateCityTimer('kafr', new Date(now.getTime() + (offsetEgypt * 3600000)));
    }

    function updateCityTimer(city, currentTime) {
        const sched = PRAYERS[city];
        let target = null, label = "";
        
        for(let i=0; i<5; i++) {
            let p = new Date(currentTime);
            p.setHours(sched.t[i][0], sched.t[i][1], 0);
            if(currentTime < p) { target = p; label = sched.n[i]; break; }
        }
        
        if(!target) { 
            target = new Date(currentTime); target.setDate(target.getDate()+1);
            target.setHours(sched.t[0][0], sched.t[0][1], 0); label = "ÙØ¬Ø± Ø§Ù„ØºØ¯";
        }

        const diff = target - currentTime;
        const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
        document.getElementById('label-'+city).innerText = "Ø§Ù„Ù‚Ø§Ø¯Ù…: " + label;
        document.getElementById('time-'+city).innerText = `${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
    }

    function render(data) {
        let stats = users.map(u => {
            let score = 0, ud = data[u] || {};
            ['fajr','dhuhr','asr','maghrib','isha'].forEach(f => score += (ud[f]?.p || 0));
            sunanModel.forEach(s => score += (ud[s.id]?.done ? s.p : 0));
            return { n: u, s: score };
        });

        document.getElementById('cards-ui').innerHTML = stats.map(st => `
            <div class="comp-card ${st.n===currentUser?'active':''}" onclick="selectUser('${st.n}')">
                <b>${st.n}</b><br><span style="color:var(--teal); font-size:1.2rem;">${st.s}</span> ğŸ®
            </div>`).join('');

        if(currentUser) {
            const ud = data[currentUser] || {};
            const part = ud.khatma || 0;
            document.getElementById('quran-part').value = part;
            document.getElementById('khatma-progress').style.width = (part/30*100) + "%";
            
            renderDetails(ud);
        }
    }

    function renderDetails(ud) {
        const fards = [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±'}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±'}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±'}, {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨'}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡'}];
        document.getElementById('fard-list').innerHTML = fards.map(f => {
            const v = ud[f.id]?.type || 'none';
            return `<div class="habit-row"><span>${f.n}</span><div>
                <button onclick="saveFard('${f.id}','m',50)" style="background:${v==='m'? 'var(--teal)':'#eee'}; color:${v==='m'?'white':'#000'}; border:none; padding:5px; border-radius:5px;">Ø¬Ù…Ø§Ø¹Ø©</button>
                <button onclick="saveFard('${f.id}','f',25)" style="background:${v==='f'? 'var(--gold)':'#eee'}; color:${v==='f'?'white':'#000'}; border:none; padding:5px; border-radius:5px;">ÙØ±Ø¯ÙŠ</button>
            </div></div>`;
        }).join('');

        document.getElementById('sunan-list').innerHTML = sunanModel.map(s => `
            <div class="habit-row"><span>${s.n} <span class="points-badge">${s.p}Ù†</span></span>
            <input type="checkbox" ${ud[s.id]?.done?'checked':''} onchange="saveExtra('${s.id}',${s.p},this.checked)" style="width:20px; height:20px;"></div>
        `).join('');
    }

    function selectUser(u) { currentUser = u; document.getElementById('user-ui').style.display='block'; updateApp(); }
    function saveKhatma(v) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/khatma`).set(Number(v)); }
    function saveFard(id,t,p) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({type:t, p:Number(p)}); }
    function saveExtra(id,p,d) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({done:d, p:d?p:0}); }
    function sendMsg() { const i = document.getElementById('chat-in'); if(!i.value) return; db.ref('chat/'+document.getElementById('date-picker').value).once('value', s=>{ let m=s.val()||[]; m.push({u:currentUser, t:i.value}); db.ref('chat/'+document.getElementById('date-picker').value).set(m); i.value=""; }); }

    window.onload = () => {
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        updateApp(); setInterval(updateTimers, 1000);
        document.getElementById('date-picker').onchange = updateApp;
    };
</script>
</body>
</html>
