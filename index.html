<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù„ØªÙ‚ÙŠ Ø¹Ù„Ù‰ Ø·Ø§Ø¹Ø© Ø§Ù„Ù„Ù‡ 2026 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #004d40; --accent: #b8860b; --gold: #d4af37;
            --bg: #f0f4f3; --white: #ffffff; --text: #1a252f;
        }
        body { font-family: 'Amiri', serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; line-height: 1.6; }
        .container { max-width: 850px; margin: auto; background: var(--white); border-radius: 25px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        /* Ø´Ø±ÙŠØ· Ø±Ù…Ø¶Ø§Ù† ÙˆØ§Ù„Ø­Ø¯ÙŠØ« */
        .ramadan-bar { background: var(--primary); color: var(--gold); padding: 12px; text-align: center; border-radius: 15px; margin-bottom: 15px; font-weight: bold; }
        .hadith-ticker { background: #fff9e6; border: 1px solid var(--gold); color: var(--primary); padding: 8px; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }

        /* ØªÙˆÙ‚ÙŠØªØ§Øª Ø§Ù„ØµÙ„Ø§Ø© */
        .prayer-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .city-card { background: #fdfdfd; border: 1px solid #eee; border-radius: 18px; padding: 12px; text-align: center; }
        .timer { color: #e67e22; font-weight: bold; font-size: 0.9rem; display: block; margin: 4px 0; }
        .imsakiya-mini { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.7rem; margin-top: 8px; }
        .imsak-item { background: #f1f1f1; padding: 3px; border-radius: 6px; }

        /* Ø§Ù„Ø¨ÙˆØ¯ÙŠÙˆÙ… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ */
        .podium-section { background: #f9f9f9; border-radius: 20px; padding: 15px; margin-bottom: 20px; }
        .podium-container { display: flex; justify-content: space-around; align-items: flex-end; height: 160px; padding-bottom: 10px; }
        .podium-col { width: 22%; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; border-radius: 10px 10px 4px 4px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem; transition: 0.5s; }
        .rank-1 { height: 110px; background: linear-gradient(var(--gold), var(--accent)); box-shadow: 0 4px 12px rgba(212,175,55,0.4); }
        .rank-2 { height: 85px; background: #bdc3c7; }
        .rank-3 { height: 65px; background: #cd7f32; }
        .rank-4 { height: 45px; background: #e0e0e0; color: #777; }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .user-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
        .u-card { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .u-card.active { border: 2px solid var(--primary); background: #f0f7f6; }
        .missing-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 5px; }
        .m-tag { font-size: 0.65rem; background: #ffeeee; color: #c0392b; padding: 2px 6px; border-radius: 5px; }

        /* Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø³Ù†Ù† */
        .task-card { background: #fcfcfc; border-radius: 20px; padding: 20px; border-right: 8px solid var(--primary); margin-bottom: 15px; }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
        .btn-group { display: flex; gap: 4px; }
        .btn-group button { border: 1px solid #ddd; padding: 6px 8px; border-radius: 10px; cursor: pointer; font-size: 0.75rem; background: #fff; }
        .act-m { background: var(--primary) !important; color: white; }
        .act-h { background: #e67e22 !important; color: white; }
        .act-s { background: #2980b9 !important; color: white; }
        .pts { font-size: 0.7rem; background: var(--gold); color: #000; padding: 2px 6px; border-radius: 6px; margin-right: 5px; font-weight: bold; }
        .link-btn { font-size: 0.75rem; color: var(--accent); text-decoration: none; border-bottom: 1px dotted; }

        /* Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        .chat-wrap { background: #fff; border: 2px solid var(--primary); border-radius: 20px; padding: 15px; }
        .chat-box { height: 180px; overflow-y: auto; background: #fbfbfb; border-radius: 12px; padding: 10px; margin-bottom: 10px; }
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 10px; background: #eee; font-size: 0.85rem; width: fit-content; }
    </style>
</head>
<body>

<div class="container">
    <div id="ramadan-countdown" class="ramadan-bar">â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…...</div>
    
    <div class="hadith-ticker">
        <marquee id="hadith-display" scrollamount="3">ğŸ“– Ù‚Ø§Ù„ ï·º: Ø£Ø­Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø£Ø¯ÙˆÙ…Ù‡Ø§ ÙˆØ¥Ù† Ù‚Ù„..</marquee>
    </div>

    <div class="prayer-box">
        <div class="city-card">
            <div style="font-family:'Reem Kufi'; color:var(--primary);">ğŸ“ ØµÙ„Ø§Ù„Ø©</div>
            <span id="salalah-timer" class="timer">--:--:--</span>
            <div id="salalah-imsak" class="imsakiya-mini"></div>
        </div>
        <div class="city-card">
            <div style="font-family:'Reem Kufi'; color:var(--primary);">ğŸ“ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</div>
            <span id="kafr-timer" class="timer">--:--:--</span>
            <div id="kafr-imsak" class="imsakiya-mini"></div>
        </div>
    </div>

    <div style="text-align:center; margin-bottom:20px;">
        <h1 style="font-family:'Reem Kufi'; color: var(--primary); margin:0;">âšœï¸ Ù†Ù„ØªÙ‚ÙŠ Ø¹Ù„Ù‰ Ø·Ø§Ø¹Ø© Ø§Ù„Ù„Ù‡ 2026</h1>
        <div id="hijri-text" style="color:var(--accent); font-weight:bold;"></div>
        <input type="date" id="date-picker" style="margin-top:10px; padding:5px; border-radius:8px; border:1px solid #ccc;">
    </div>

    <div class="podium-section">
        <h4 style="text-align:center; margin:0 0 10px 0;">ğŸ† Ù…ØªØµØ¯Ø±Ùˆ Ø§Ù„ÙŠÙˆÙ…</h4>
        <div id="daily-podium" class="podium-container"></div>
        <h4 style="text-align:center; margin:15px 0 10px 0; color:var(--accent);">ğŸŒŸ Ø§Ù„Ø­ØµØ§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</h4>
        <div id="yearly-podium" class="podium-container"></div>
    </div>

    <div id="user-list" class="user-grid"></div>

    <div id="main-app" style="display:none;">
        <div class="task-card">
            <h3 style="margin:0 0 10px 0;">ğŸ•‹ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³</h3>
            <div id="fard-area"></div>
        </div>

        <div class="task-card" style="border-right-color: #27ae60;">
            <h3 style="margin:0 0 10px 0; color:#27ae60;">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø±ÙˆØ§ØªØ¨</h3>
            <div id="sunnah-area"></div>
        </div>

        <div class="task-card" style="border-right-color: #f39c12;">
            <h3 style="margin:0 0 10px 0; color:#f39c12;">ğŸ“‘ Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ø¯</h3>
            <div class="row">
                <span>ğŸ“– ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù† (Ø£Ø¬Ø²Ø§Ø¡) <span class="pts">100Ù†</span> <a href="https://quran.com" target="_blank" class="link-btn">Ø§Ù„Ù…ØµØ­Ù</a></span>
                <input type="number" id="q-part" step="0.25" min="0" onchange="updateQ(this.value)" style="width:50px;">
            </div>
            <div id="azkar-area"></div>
        </div>
    </div>

    <div class="chat-wrap">
        <div id="chat-msgs" class="chat-box"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="chat-in" placeholder="Ø§ÙƒØªØ¨ ØªØ´Ø¬ÙŠØ¹Ø§Ù‹..." style="flex:1; padding:8px; border-radius:10px; border:1px solid #ddd;">
            <button onclick="send()" style="background:var(--primary); color:white; border:none; padding:0 15px; border-radius:10px;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<script>
    // Firebase
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1", storageBucket: "ebada-656e1.firebasestorage.app", messagingSenderId: "705608653939", appId: "1:705608653939:web:5ab3609a6f7ccc8675de06" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();

    let currentUser = null;
    const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];
    const prayers = [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±', i:'ğŸŒ…'}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±', i:'â˜€ï¸'}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±', i:'ğŸŒ¤ï¸'}, {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨', i:'ğŸŒ‡'}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡', i:'ğŸŒƒ'}];
    const sunan = [{id:'s_f', n:'Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±', p:20, r:'2Ø±'}, {id:'duha', n:'Ø§Ù„Ø¶Ø­Ù‰', p:20, r:'2Ø±+'}, {id:'s_d_pre', n:'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±-Ù‚Ø¨Ù„', p:20, r:'4Ø±'}, {id:'s_d_post', n:'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±-Ø¨Ø¹Ø¯', p:15, r:'2Ø±'}, {id:'s_m', n:'Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨', p:15, r:'2Ø±'}, {id:'s_i', n:'Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡', p:15, r:'2Ø±'}, {id:'qiyam', n:'Ø§Ù„Ù‚ÙŠØ§Ù…/Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­', p:60, r:'8Ø±'}, {id:'witr', n:'Ø§Ù„ÙˆØªØ±', p:20, r:'1Ø±'}];
    const azkar = [{id:'morn', n:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', p:25, l:'https://alazkar.today/'}, {id:'eve', n:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', p:25, l:'https://alazkar.today/'}, {id:'sleep', n:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…', p:15, l:'https://alazkar.today/'}, {id:'mulk', n:'Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ', p:20, l:'https://quran.com/67'}, {id:'kahf', n:'Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù', p:40, l:'https://quran.com/18'}];
    const times = { salalah: {fajr:"05:18", dhuhr:"12:32", asr:"15:48", maghrib:"18:12", isha:"19:28"}, kafr: {fajr:"05:22", dhuhr:"12:12", asr:"15:15", maghrib:"17:42", isha:"19:08"} };

    function calcScore(d) {
        if(!d) return 0;
        let s = (d.q_part || 0) * 100;
        Object.values(d).forEach(v => { if(v.p) s += v.p; });
        return s;
    }

    function sync() {
        const date = document.getElementById('date-picker').value;
        const isFri = new Date(date).getDay() === 5;
        document.getElementById('hijri-text').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(new Date(date));
        
        db.ref('osraty').on('value', snap => {
            const all = snap.val() || {}; const day = all[date] || {};
            
            // Ø§Ù„Ø¨ÙˆØ¯ÙŠÙˆÙ… Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙˆØ§Ù„Ø³Ù†ÙˆÙŠ
            const daily = users.map(u => ({n:u, s:calcScore(day[u])})).sort((a,b)=>b.s-a.s);
            const yearly = users.map(u => {
                let t = 0; Object.values(all).forEach(d => t += calcScore(d[u]));
                return {n:u, s:t};
            }).sort((a,b)=>b.s-a.s);

            const buildPodium = (data, id) => {
                const order = [data[3], data[1], data[0], data[2]];
                const cls = ['rank-4','rank-2','rank-1','rank-3'];
                document.getElementById(id).innerHTML = order.map((u,i)=> u ? `
                    <div class="podium-col">
                        <small style="font-weight:bold">${u.s}</small>
                        <div class="bar ${cls[i]}">${i===2?'1':i===1?'2':i===3?'3':'4'}</div>
                        <small>${u.n}</small>
                    </div>` : '').join('');
            };
            buildPodium(daily, 'daily-podium'); buildPodium(yearly, 'yearly-podium');

            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø§Ù‚ØµØ©
            document.getElementById('user-list').innerHTML = users.map(u => {
                const ud = day[u] || {};
                let missing = [];
                prayers.forEach(p => { if(!ud[(isFri && p.id==='dhuhr')?'jumuah':p.id]) missing.push(p.n); });
                return `<div class="u-card ${u===currentUser?'active':''}" onclick="setUser('${u}')">
                    <div><b>ğŸ‘¤ ${u}</b><div class="missing-tags">${missing.map(m=>`<span class="m-tag">${m}</span>`).join('')}</div></div>
                    <b style="color:var(--primary)">${calcScore(ud)}Ù†</b>
                </div>`;
            }).join('');

            if(currentUser) renderTasks(day[currentUser] || {}, isFri);
        });
    }

    function renderTasks(ud, isFri) {
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('fard-area').innerHTML = prayers.map(p => {
            let id = (isFri && p.id==='dhuhr') ? 'jumuah' : p.id;
            let name = (isFri && p.id==='dhuhr') ? 'ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©' : p.n;
            const v = ud[id]?.type || '';
            return `<div class="row"><span>${p.i} ${name}</span><div class="btn-group">
                <button class="${v==='m'?'act-m':''}" onclick="saveF('${id}','m',100)">Ù…Ø³Ø¬Ø¯</button>
                <button class="${v==='h'?'act-h':''}" onclick="saveF('${id}','h',70)">Ø¬Ù…Ø§Ø¹Ø©</button>
                <button class="${v==='s'?'act-s':''}" onclick="saveF('${id}','s',40)">ÙØ±Ø¯ÙŠ</button>
            </div></div>`;
        }).join('');

        document.getElementById('sunnah-area').innerHTML = sunan.map(s => `
            <div class="row"><span>${s.n} <span class="pts">${s.p}Ù†</span> <small>${s.r}</small></span>
            <input type="checkbox" ${ud[s.id]?.done?'checked':''} onchange="saveC('${s.id}',${s.p},this.checked)"></div>`).join('');

        document.getElementById('azkar-area').innerHTML = azkar.map(a => `
            <div class="row"><span>${a.n} <span class="pts">${a.p}Ù†</span> <a href="${a.l}" target="_blank" class="link-btn">Ø±Ø§Ø¨Ø·</a></span>
            <input type="checkbox" ${ud[a.id]?.done?'checked':''} onchange="saveC('${a.id}',${a.p},this.checked)"></div>`).join('');
        document.getElementById('q-part').value = ud.q_part || 0;
    }

    function updateTimer(city, offset, tid, iid) {
        const now = new Date(); const cNow = new Date(now.getTime() + (now.getTimezoneOffset()*60000) + (3600000*offset));
        const ct = times[city]; let nextP = null, nextT = null;
        for(let p in ct) {
            const [h,m] = ct[p].split(':'); const pD = new Date(cNow); pD.setHours(h,m,0);
            if(pD > cNow) { nextP=p; nextT=pD; break; }
        }
        if(!nextP) { const [h,m] = ct.fajr.split(':'); nextT=new Date(cNow); nextT.setDate(nextT.getDate()+1); nextT.setHours(h,m,0); nextP="fajr"; }
        const diff = nextT - cNow;
        const hh=Math.floor(diff/3600000), mm=Math.floor((diff%3600000)/60000), ss=Math.floor((diff%60000)/1000);
        document.getElementById(tid).innerText = `Ø¨Ø§Ù‚ÙŠ Ù„Ù€ ${nextP}: ${hh}:${mm}:${ss}`;
        document.getElementById(iid).innerHTML = Object.entries(ct).map(([k,v])=>`<div class="imsak-item"><b>${k}</b><br>${v}</div>`).join('');
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­ÙØ¸
    function setUser(u) { currentUser = u; sync(); }
    function saveF(id, t, p) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({type:t, p}); }
    function saveC(id, p, d) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({done:d, p: d?p:0}); }
    function updateQ(v) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/q_part`).set(Number(v)); }
    function send() { 
        const m = document.getElementById('chat-in').value; if(!currentUser || !m) return;
        db.ref('osraty_chat').push({u:currentUser, m:m, t:new Date().toLocaleTimeString('ar-EG',{hour:'2-digit', minute:'2-digit'})});
        document.getElementById('chat-in').value = '';
    }

    // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
    document.getElementById('date-picker').onchange = sync;
    const ramDiff = Math.floor((new Date("2026-02-18") - new Date())/(1000*60*60*24));
    document.getElementById('ramadan-countdown').innerText = `â³ Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø±Ù…Ø¶Ø§Ù† 2026: ${ramDiff} ÙŠÙˆÙ…`;
    setInterval(()=>{ updateTimer('salalah', 4, 'salalah-timer', 'salalah-imsak'); updateTimer('kafr', 2, 'kafr-timer', 'kafr-imsak'); }, 1000);
    db.ref('osraty_chat').limitToLast(10).on('value', s => {
        document.getElementById('chat-msgs').innerHTML = '';
        s.forEach(c => { const d = c.val(); document.getElementById('chat-msgs').innerHTML += `<div class="msg"><b>${d.u}:</b> ${d.m}</div>`; });
        document.getElementById('chat-msgs').scrollTop = document.getElementById('chat-msgs').scrollHeight;
    });
    sync();
</script>
</body>
</html>
