<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø§Ø¨ Ø±Ù…Ø¶Ø§Ù† 2026 - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù‚</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --main-bg: #fdfbf7; --primary-gold: #d4af37; --bright-green: #27ae60; --warm-orange: #f39c12; --text-dark: #2c3e50; }
        body { font-family: 'Amiri', serif; background-color: var(--main-bg); background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png'); color: var(--text-dark); margin: 0; padding: 10px; }
        .main-container { max-width: 850px; margin: auto; background: white; border: 4px double var(--primary-gold); border-radius: 25px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        /* Ù‡ÙŠØ¯Ø± Ø²Ø§Ù‡ÙŠ */
        .header-bar { background: linear-gradient(135deg, var(--primary-gold), var(--warm-orange)); color: white; padding: 25px; border-radius: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); }
        
        .city-timer-box { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .timer-card { background: #fff; border: 2px solid #eee; border-top: 5px solid var(--bright-green); border-radius: 15px; padding: 15px; text-align: center; transition: 0.3s; }
        .timer-card h4 { margin: 5px 0; color: var(--bright-green); font-size: 1.1rem; }
        .next-prayer-name { font-size: 0.8rem; color: #7f8c8d; font-weight: bold; }
        .time-remaining { font-size: 1.2rem; font-weight: bold; color: var(--text-dark); margin-top: 5px; }

        /* Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© */
        .imsakiya-container { background: #f9f9f9; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; }
        .imsakiya-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .imsakiya-table th { background: var(--primary-gold); color: white; padding: 10px; border: 1px solid #fff; }
        .imsakiya-table td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        .city-label { font-weight: bold; color: var(--bright-green); }

        .weekly-challenge { background: var(--bright-green); color: white; padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; font-size: 1.1rem; margin-bottom: 20px; }
        
        .comp-card { background: #fff; border: 2px solid var(--primary-gold); border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; }
        .comp-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .comp-card.active { background: var(--warm-orange); color: white; border-color: var(--warm-orange); }

        .khatma-section { background: #fff8e1; border-radius: 15px; padding: 20px; border: 1px solid var(--primary-gold); }
        .progress-bar-bg { background: #e0e0e0; height: 15px; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-bar-fill { background: linear-gradient(90deg, var(--bright-green), var(--warm-orange)); height: 100%; transition: width 0.5s; }

        .chat-area { height: 150px; overflow-y: auto; background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-bar">
        <h1 style="margin:0; font-family:'Reem Kufi'; font-size: 2.2rem;">ğŸŒ¸ Ù…ÙØ­Ø±Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© 2026 ğŸŒ¸</h1>
        <div id="hijri-display" style="font-size: 1.2rem; margin-top: 5px;"></div>
        <input type="date" id="date-picker" style="margin-top:15px; padding:8px; border-radius:10px; border:none; font-weight:bold;">
    </div>

    <div class="city-timer-box">
        <div class="timer-card">
            <h4>ğŸ‡´ğŸ‡² ØµÙ„Ø§Ù„Ø©</h4>
            <div id="label-salalah" class="next-prayer-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</div>
            <div id="time-salalah" class="time-remaining">00:00:00</div>
        </div>
        <div class="timer-card">
            <h4>ğŸ‡ªğŸ‡¬ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</h4>
            <div id="label-kafr" class="next-prayer-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</div>
            <div id="time-kafr" class="time-remaining">00:00:00</div>
        </div>
    </div>

    <div class="imsakiya-container">
        <h3 style="text-align:center; color: var(--primary-gold);">ğŸ“œ Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„ÙŠÙˆÙ… (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</h3>
        <table class="imsakiya-table">
            <thead>
                <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ÙØ¬Ø±</th><th>Ø§Ù„Ø¸Ù‡Ø±</th><th>Ø§Ù„Ø¹ØµØ±</th><th>Ø§Ù„Ù…ØºØ±Ø¨</th><th>Ø§Ù„Ø¹Ø´Ø§Ø¡</th></tr>
            </thead>
            <tbody>
                <tr><td class="city-label">ØµÙ„Ø§Ù„Ø©</td><td>05:12</td><td>12:34</td><td>03:54</td><td>06:22</td><td>07:38</td></tr>
                <tr><td class="city-label">ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</td><td>05:02</td><td>12:12</td><td>03:14</td><td>05:54</td><td>07:16</td></tr>
            </tbody>
        </table>
    </div>

    <div class="weekly-challenge" id="challenge-text">ğŸ® ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…: ...</div>

    <div id="cards-ui" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;"></div>

    <div id="user-ui" style="display:none;">
        <div class="khatma-section">
            <h3 style="margin-top:0">ğŸ“– Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©</h3>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b>Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ:</b>
                <input type="number" id="quran-part" min="0" max="30" onchange="saveKhatma(this.value)" style="width:70px; padding:8px; border-radius:8px; border:1px solid var(--primary-gold);">
            </div>
            <div class="progress-bar-bg"><div id="khatma-progress" class="progress-bar-fill" style="width: 0%"></div></div>
            <div id="khatma-percent" style="text-align:center; font-weight:bold; color:var(--bright-green);">0%</div>
        </div>

        <div style="background:white; border:1px solid #ddd; padding:15px; border-radius:15px; margin-top:15px;">
            <h3>ğŸ•‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª</h3>
            <div id="fard-list"></div>
            <div id="extra-list" style="margin-top:15px; border-top:1px dashed #ddd; padding-top:10px;"></div>
        </div>

        <div style="margin-top:20px;">
            <h3>ğŸ’¬ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h3>
            <div id="chat-box" class="chat-area"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-in" placeholder="Ø£Ø±Ø³Ù„ ØªØ­ÙŠØ© Ø£Ùˆ ØªØ´Ø¬ÙŠØ¹Ø§Ù‹..." style="flex:1; padding:10px; border:1px solid #ddd; border-radius:10px;">
                <button onclick="sendMsg()" style="background:var(--bright-green); color:white; padding:10px 20px; border:none; border-radius:10px; cursor:pointer; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1", storageBucket: "ebada-656e1.firebasestorage.app", messagingSenderId: "705608653939", appId: "1:705608653939:web:5ab3609a6f7ccc8675de06" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();
    
    let currentUser = null; const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];
    
    // Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø³Ø§Ø¹Ø§Øª : Ø¯Ù‚Ø§Ø¦Ù‚)
    const PRAYER_TIMES = {
        salalah: { names: ['Ø§Ù„ÙØ¬Ø±','Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨','Ø§Ù„Ø¹Ø´Ø§Ø¡'], times: [[5,12], [12,34], [15,54], [18,22], [19,38]] },
        kafr: { names: ['Ø§Ù„ÙØ¬Ø±','Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨','Ø§Ù„Ø¹Ø´Ø§Ø¡'], times: [[5,2], [12,12], [15,14], [17,54], [19,16]] }
    };

    function updateSmartTimers() {
        const now = new Date();
        
        // ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ù„Ø©
        updateCityTimer('salalah', now, 0); // ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø¨ÙØ±Ø¶ Ø£Ù†Ù‡ ØµÙ„Ø§Ù„Ø© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡)
        // ØªØ­Ø¯ÙŠØ« ÙƒÙØ± Ø§Ù„Ø´ÙŠØ® (ÙØ§Ø±Ù‚ -2 Ø³Ø§Ø¹Ø© Ø¹Ù† ØµÙ„Ø§Ù„Ø©)
        const egyptTime = new Date(now.getTime() + ( -2 * 3600000));
        updateCityTimer('kafr', egyptTime, 0);
    }

    function updateCityTimer(cityKey, currentTime, offset) {
        const schedule = PRAYER_TIMES[cityKey];
        let nextIdx = 0;
        let found = false;

        for (let i = 0; i < schedule.times.length; i++) {
            let pTime = new Date(currentTime);
            pTime.setHours(schedule.times[i][0], schedule.times[i][1], 0);
            if (currentTime < pTime) {
                nextIdx = i;
                found = true;
                break;
            }
        }
        
        // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ù„Ù‚Ø§Ø¯Ù… ÙØ¬Ø± Ø§Ù„ØºØ¯
        if (!found) nextIdx = 0; 

        let target = new Date(currentTime);
        target.setHours(schedule.times[nextIdx][0], schedule.times[nextIdx][1], 0);
        if (!found) target.setDate(target.getDate() + 1);

        const diff = target - currentTime;
        const h = Math.floor(diff/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);

        document.getElementById(`label-${cityKey}`).innerText = "Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: " + schedule.names[nextIdx];
        document.getElementById(`time-${cityKey}`).innerText = `${h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    }

    function sync() {
        const d = document.getElementById('date-picker').value;
        document.getElementById('hijri-display').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(new Date(d));
        db.ref('osraty/' + d).on('value', snap => render(snap.val() || {}));
        db.ref('chat/' + d).on('value', snap => {
            const m = snap.val() || [];
            document.getElementById('chat-box').innerHTML = m.map(x => `<div><b style="color:var(--bright-green)">${x.u}:</b> ${x.t}</div>`).join('');
            document.getElementById('chat-box').scrollTop = 9999;
        });
    }

    function render(allData) {
        let stats = users.map(u => {
            let score = 0; let uData = allData[u] || {};
            ['fajr','dhuhr','asr','maghrib','isha'].forEach(id => { if(uData[id]?.p) score += Number(uData[id].p); });
            if(uData.traweeh?.done) score += 60;
            return { n: u, s: score };
        });

        document.getElementById('cards-ui').innerHTML = stats.map(st => `
            <div class="comp-card ${st.n === currentUser ? 'active' : ''}" onclick="selectUser('${st.n}')">
                <b>${st.n}</b><br><span style="font-size:1.4rem">${st.s}</span> ğŸ®
            </div>`).join('');

        if(currentUser) {
            const part = allData[currentUser]?.khatma || 0;
            document.getElementById('quran-part').value = part;
            document.getElementById('khatma-progress').style.width = (part/30*100) + "%";
            document.getElementById('khatma-percent').innerText = `ØªÙ… Ø¥Ù†Ø¬Ø§Ø² ${Math.round(part/30*100)}% Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†`;
            renderUserForms(allData[currentUser] || {});
        }
    }

    function renderUserForms(uData) {
        const fards = [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±'}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±'}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±'}, {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨'}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡'}];
        document.getElementById('fard-list').innerHTML = fards.map(f => {
            const v = uData[f.id]?.type || 'none';
            return `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span><b>${f.n}</b></span>
                <div>
                    <button onclick="saveFard('${f.id}','m',50)" style="background:${v==='m'? 'var(--bright-green)':'#eee'}; color:${v==='m'?'white':'#000'}; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Ø¬Ù…Ø§Ø¹Ø©</button>
                    <button onclick="saveFard('${f.id}','f',25)" style="background:${v==='f'? 'var(--warm-orange)':'#eee'}; color:${v==='f'?'white':'#000'}; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">ÙØ±Ø¯ÙŠ</button>
                </div>
            </div>`;
        }).join('');
        
        document.getElementById('extra-list').innerHTML = `
            <div style="display:flex; justify-content:space-between;">
                <span>âœ¨ ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ / Ø§Ù„Ù‚ÙŠØ§Ù…</span>
                <input type="checkbox" ${uData.traweeh?.done?'checked':''} onchange="saveExtra('traweeh',60,this.checked)" style="transform:scale(1.5);">
            </div>
        `;
    }

    function selectUser(u) { currentUser = u; document.getElementById('user-ui').style.display='block'; sync(); }
    function saveKhatma(v) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/khatma`).set(Number(v)); }
    function saveFard(id,t,p) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({type:t, p:Number(p)}); }
    function saveExtra(id,p,d) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({done:d, p:d?p:0}); }
    function sendMsg() { const i = document.getElementById('chat-in'); if(!i.value) return; db.ref('chat/'+document.getElementById('date-picker').value).once('value', s=>{ let m=s.val()||[]; m.push({u:currentUser, t:i.value}); db.ref('chat/'+document.getElementById('date-picker').value).set(m); i.value=""; }); }

    window.onload = () => {
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        sync();
        setInterval(updateSmartTimers, 1000);
    };
</script>
</body>
</html>
