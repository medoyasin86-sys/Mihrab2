<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù„ØªÙ‚Ù‰ Ø·Ø§Ø¹Ø§ØªÙ†Ø§ 2026 | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù„ØªÙ‚Ù‰ Ø·Ø§Ø¹Ø§ØªÙ†Ø§ 2026 | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #1a4d2e; --gold: #c5a059; --gold-light: #e6cc92;
            --bg: #f9f6f0; --card-bg: rgba(255,255,255,0.98); --text: #1a4d2e;
        }
        body.dark-mode {
            --primary: #c5a059; --gold: #e6cc92; --bg: #121212;
            --card-bg: #1e1e1e; --text: #e0e0e0;
        }
        body { font-family: 'Amiri', serif; background-color: var(--bg); margin: 0; padding: 10px; color: var(--text); transition: 0.3s; }
        .main-container { max-width: 900px; margin: auto; background: var(--card-bg); border: 3px double var(--gold); border-radius: 20px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª */
        .header-bar { background: linear-gradient(135deg, #1a4d2e, #0a2b1a); color: white; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); text-align: center; position: relative; }
        .prayer-times-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 15px; font-size: 0.8rem; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; }
        
        /* Ù…Ù†ØµØ© Ø§Ù„ØªØªÙˆÙŠØ¬ */
        .podium-container { display: flex; justify-content: center; align-items: flex-end; height: 120px; margin: 20px 0; gap: 10px; }
        .podium-step { width: 70px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; color: white; border-radius: 8px 8px 2px 2px; position: relative; font-weight: bold; }
        .p-1 { height: 100px; background: linear-gradient(to top, #b8860b, #f1c40f); border: 2px solid gold; box-shadow: 0 0 15px rgba(241, 196, 15, 0.4); }
        .p-2 { height: 75px; background: linear-gradient(to top, #7f8c8d, #bdc3c7); border: 2px solid silver; }
        .p-3 { height: 55px; background: linear-gradient(to top, #8e44ad, #9b59b6); border: 2px solid #ce93d8; }
        .p-name { position: absolute; bottom: -25px; color: var(--text); font-size: 0.8rem; width: 100%; text-align: center; }
        .p-score { font-size: 0.9rem; margin-bottom: 5px; }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .section-card { background: var(--card-bg); border: 1px solid var(--gold); border-radius: 15px; margin-top: 15px; overflow: hidden; }
        .habit-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px dashed var(--gold-light); }
        .opt-btn { font-size: 0.75rem; padding: 8px; border-radius: 8px; border: 1px solid var(--gold); cursor: pointer; background: transparent; color: var(--text); flex: 1; margin: 0 2px; }
        .opt-btn.selected { background: var(--gold); color: white; }
        .external-link { text-decoration: none; font-size: 1.2rem; margin-right: 10px; }
        
        .comp-card { padding:10px; text-align:center; cursor:pointer; border-radius: 12px; border:1px solid var(--gold); transition: 0.2s; }
        .comp-card.active { border: 2.5px solid var(--primary); transform: scale(1.02); background: rgba(197, 160, 89, 0.1); }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-bar">
        <h1 style="margin:0; font-family:'Reem Kufi'; color: var(--gold-light);">ğŸ•Œ Ù…Ù„ØªÙ‚Ù‰ Ø·Ø§Ø¹Ø§ØªÙ†Ø§ 2026</h1>
        <input type="date" id="date-picker" style="margin-top:10px;">
        <div id="prayer-times" class="prayer-times-grid">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª...</div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top:15px;">
        <div><h4 style="text-align:center; margin:5px;">ğŸ† Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h4><div id="daily-podium" class="podium-container"></div></div>
        <div><h4 style="text-align:center; margin:5px;">âœ¨ Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h4><div id="annual-podium" class="podium-container"></div></div>
    </div>

    <div id="cards-ui" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 35px;"></div>

    <div id="user-ui" style="display:none; margin-top:20px;">
        <h2 id="current-user-title" style="text-align:center; color:var(--gold);"></h2>
        
        <div class="section-card">
            <h3 style="padding:10px; margin:0; background:var(--primary); color:white;">ğŸ•‹ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³</h3>
            <div id="fard-list"></div>
        </div>

        <div class="section-card">
            <h3 style="padding:10px; margin:0; background:var(--primary); color:white;">ğŸŒ± Ø§Ù„Ø³Ù†Ù† Ø§Ù„Ø±ÙˆØ§ØªØ¨ (12 Ø±ÙƒØ¹Ø©)</h3>
            <div id="sunan-list"></div>
        </div>

        <div class="section-card">
            <h3 style="padding:10px; margin:0; background:var(--primary); color:white;">ğŸ“¿ Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
            <div id="extra-list"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let currentUser = null;
    const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];

    const model = {
        fard: [
            {id:'fajr', n:'Ø§Ù„ÙØ¬Ø±', pts: {m:100, g:30, f:15, q:5}},
            {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±', pts: {m:50, g:30, f:15, q:5}},
            {id:'asr', n:'Ø§Ù„Ø¹ØµØ±', pts: {m:50, g:30, f:15, q:5}},
            {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨', pts: {m:50, g:30, f:15, q:5}},
            {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡', pts: {m:50, g:30, f:15, q:5}}
        ],
        sunan: [
            {id:'s_fajr', n:'Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø± (Ø±ÙƒØ¹ØªØ§Ù† Ù‚Ø¨Ù„)', p:20},
            {id:'s_dhuhr_b', n:'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø± (4 Ù‚Ø¨Ù„)', p:20},
            {id:'s_dhuhr_a', n:'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø± (2 Ø¨Ø¹Ø¯)', p:15},
            {id:'s_maghrib', n:'Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨ (2 Ø¨Ø¹Ø¯)', p:15},
            {id:'s_isha', n:'Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ (2 Ø¨Ø¹Ø¯)', p:15},
            {id:'s_witr', n:'Ø§Ù„ÙˆØªØ±', p:30}
        ],
        extra: [
            {id:'azkar_s', n:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', p:30, link:'https://www.hisnmuslim.com/i/ar/27'},
            {id:'azkar_e', n:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', p:30, link:'https://www.hisnmuslim.com/i/ar/28'},
            {id:'mulk', n:'Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ', p:40, link:'https://quran.com/67'},
            {id:'quran', n:'Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ', p:50, link:'#'},
            {id:'duha', n:'ØµÙ„Ø§Ø© Ø§Ù„Ø¶Ø­Ù‰', p:25, link:'#'}
        ]
    };

    async function getPrayers() {
        try {
            const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Cairo&country=Egypt&method=5');
            const data = await res.json();
            const t = data.data.timings;
            document.getElementById('prayer-times').innerHTML = `
                <div>Ø§Ù„ÙØ¬Ø±<br>${t.Fajr}</div><div>Ø§Ù„Ø¸Ù‡Ø±<br>${t.Dhuhr}</div>
                <div>Ø§Ù„Ø¹ØµØ±<br>${t.Asr}</div><div>Ø§Ù„Ù…ØºØ±Ø¨<br>${t.Maghrib}</div><div>Ø§Ù„Ø¹Ø´Ø§Ø¡<br>${t.Isha}</div>
            `;
        } catch(e) { console.log("Prayer API Error"); }
    }

    function sync() {
        const d = document.getElementById('date-picker').value;
        db.ref('osraty/' + d).on('value', snap => render(snap.val() || {}));
        updateAnnual();
    }

    function render(allData) {
        let stats = users.map(u => {
            let score = 0; let uData = allData[u] || {};
            [...model.fard, ...model.sunan, ...model.extra].forEach(h => {
                if(uData[h.id]) score += Number(uData[h.id].p || 0);
            });
            return { n: u, s: score };
        });

        drawPodium('daily-podium', stats);
        document.getElementById('cards-ui').innerHTML = stats.map(st => `
            <div class="comp-card ${st.n === currentUser ? 'active' : ''}" onclick="selectUser('${st.n}')">
                <b>${st.n}</b><br><span>${st.s}Ù†</span>
            </div>`).join('');
        
        if(currentUser) renderForms(allData[currentUser] || {});
    }

    function drawPodium(el, data) {
        const sorted = [...data].sort((a,b) => b.s - a.s);
        const order = [1, 0, 2]; // 2nd, 1st, 3rd
        const steps = ['p-2', 'p-1', 'p-3'];
        
        document.getElementById(el).innerHTML = order.map((idx, i) => {
            const user = sorted[idx] || {n: '-', s: 0};
            return `
            <div class="podium-step ${steps[i]}">
                <span class="p-score">${user.s}</span>
                <div class="p-name">${user.n}</div>
            </div>`;
        }).join('');
    }

    function renderForms(userData) {
        // Render Fard
        document.getElementById('fard-list').innerHTML = model.fard.map(h => {
            const cur = userData[h.id]?.type;
            return `<div class="habit-row">
                <b>${h.n}</b>
                <div style="display:flex;">
                    ${Object.entries(h.pts).map(([k,v]) => `
                        <button class="opt-btn ${cur===k?'selected':''}" onclick="save('${h.id}',{type:'${k}', p:${v}})">
                            ${k==='m'?'Ù…Ø³Ø¬Ø¯':k==='g'?'Ø¬Ù…Ø§Ø¹Ø©':k==='f'?'ÙØ±Ø¯ÙŠ':'Ù‚Ø¶Ø§Ø¡'}
                        </button>
                    `).join('')}
                </div>
            </div>`;
        }).join('');

        // Render Sunan & Extra
        const renderChecklist = (list, target) => {
            document.getElementById(target).innerHTML = list.map(h => {
                const done = userData[h.id]?.done;
                return `<div class="habit-row">
                    <span>${h.link ? `<a href="${h.link}" target="_blank" class="external-link">ğŸ“–</a>` : ''} ${h.n}</span>
                    <input type="checkbox" ${done?'checked':''} onchange="save('${h.id}', {done:this.checked, p:this.checked?${h.p}:0})" style="transform:scale(1.5);">
                </div>`;
            }).join('');
        };
        renderChecklist(model.sunan, 'sunan-list');
        renderChecklist(model.extra, 'extra-list');
    }

    function updateAnnual() {
        db.ref('osraty').once('value', snap => {
            const data = snap.val() || {}; let annual = users.map(u => ({n:u, s:0}));
            Object.values(data).forEach(day => {
                users.forEach((u, i) => { if(day[u]) Object.values(day[u]).forEach(t => annual[i].s += (t.p || 0)); });
            });
            drawPodium('annual-podium', annual);
        });
    }

    function save(id, val) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set(val); }
    function selectUser(u) { currentUser = u; document.getElementById('user-ui').style.display='block'; document.getElementById('current-user-title').innerText="Ø³Ø¬Ù„ Ø§Ù„Ø·Ø§Ø¹Ø§Øª Ù„Ù€ " + u; sync(); }

    window.onload = () => {
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').onchange = sync;
        getPrayers();
        sync();
    };
</script>
</body>
</html>400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #1a4d2e; 
            --gold: #c5a059; 
            --gold-light: #e6cc92;
            --bg: #f9f6f0; 
            --card-bg: rgba(255,255,255,0.98);
            --text: #1a4d2e;
        }

        body.dark-mode {
            --primary: #c5a059; --gold: #e6cc92; --bg: #121212;
            --card-bg: #1e1e1e; --text: #e0e0e0;
        }

        body { 
            font-family: 'Amiri', serif; background-color: var(--bg); 
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png'); 
            margin: 0; padding: 10px; color: var(--text); transition: 0.3s;
        }

        .main-container { max-width: 850px; margin: auto; background: var(--card-bg); border: 3px double var(--gold); border-radius: 20px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        .header-bar { background: linear-gradient(135deg, #1a4d2e, #0a2b1a); color: white; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); text-align: center; position: relative; }

        .theme-toggle { position: absolute; top: 10px; left: 10px; background: var(--gold); border: none; padding: 5px 10px; border-radius: 20px; cursor: pointer; }

        .section-card { background: var(--card-bg); border: 1px solid var(--gold); border-radius: 15px; margin-top: 15px; overflow: hidden; }

        .habit-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px dashed var(--gold-light); flex-wrap: wrap; gap: 10px; }

        .opt-btn { 
            font-size: 0.75rem; padding: 8px 5px; border-radius: 8px; 
            border: 1px solid var(--gold); cursor: pointer; 
            background: transparent; color: var(--text); flex: 1; min-width: 60px;
            display: flex; flex-direction: column; align-items: center; gap: 2px;
        }

        .opt-btn small { font-size: 0.6rem; opacity: 0.8; }
        .opt-btn.selected { background: var(--gold); color: white; box-shadow: inset 0 0 5px rgba(0,0,0,0.2); }
        .opt-btn.fajr-special { border: 2px solid #e67e22; }

        .crown { color: #f1c40f; font-size: 1.2rem; margin-right: 5px; }
        
        .comp-card { padding:10px; text-align:center; cursor:pointer; border-radius: 12px; transition: 0.2s; }
        .comp-card.active { background: rgba(197, 160, 89, 0.1); border: 2px solid var(--primary) !important; }

        .podium-step { background: var(--primary); border: 1.5px solid var(--gold); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; color: white; border-radius: 5px 5px 0 0; }
        .p1 { background: linear-gradient(to top, #b8860b, #f1c40f); }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-bar">
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        <h1 style="margin:0; font-family:'Reem Kufi'; color: var(--gold-light);">ğŸ•Œ Ù…Ù„ØªÙ‚Ù‰ Ø·Ø§Ø¹Ø§ØªÙ†Ø§ 2026</h1>
        <input type="date" id="date-picker" style="margin-top:10px; padding: 5px; border-radius: 5px;">
        <div id="hijri-display" style="margin-top: 8px; font-weight: bold; color: var(--gold);"></div>
    </div>

    <div class="podiums-wrapper" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
        <div><div style="text-align:center; font-size:0.8rem;">ğŸ† Ø§Ù„ÙŠÙˆÙ…</div><div id="daily-podium" style="display: flex; align-items: flex-end; justify-content: center; height: 80px; border-bottom: 2px solid var(--gold);"></div></div>
        <div><div style="text-align:center; font-size:0.8rem;">âœ¨ Ø§Ù„Ø¹Ø§Ù…</div><div id="annual-podium" style="display: flex; align-items: flex-end; justify-content: center; height: 80px; border-bottom: 2px solid var(--gold);"></div></div>
    </div>

    <div id="cards-ui" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;"></div>

    <div id="user-ui" style="display:none; margin-top:20px;">
        <h2 id="current-user-title" style="text-align:center; color:var(--gold); border-bottom: 2px solid var(--gold); padding-bottom: 10px;"></h2>
        
        <div class="section-card">
            <h3 style="padding: 10px; margin: 0; background: var(--primary); color: white;">ğŸ•‹ Ø§Ù„ÙØ±ÙˆØ¶ Ø§Ù„Ø®Ù…Ø³Ø© (Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²)</h3>
            <div id="fard-list"></div>
        </div>

        <div class="section-card">
            <h3 style="padding: 10px; margin: 0; background: var(--primary); color: white;">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ø¯</h3>
            <div id="extra-list"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let currentUser = null;
    const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];

    const model = {
        fard: [
            {id:'fajr', n:'Ø§Ù„ÙØ¬Ø±', icon:'ğŸŒ…', points: {m:100, g:30, f:15, q:5}}, 
            {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±', icon:'â˜€ï¸', points: {m:50, g:30, f:15, q:5}}, 
            {id:'asr', n:'Ø§Ù„Ø¹ØµØ±', icon:'ğŸŒ¤ï¸', points: {m:50, g:30, f:15, q:5}}, 
            {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨', icon:'ğŸŒ‡', points: {m:50, g:30, f:15, q:5}}, 
            {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡', icon:'ğŸŒ™', points: {m:50, g:30, f:15, q:5}}
        ],
        extra: [
            {id:'qiyam', n:'ØµÙ„Ø§Ø© Ø§Ù„Ù‚ÙŠØ§Ù…', p:40, icon:'ğŸŒƒ'},
            {id:'duha', n:'ØµÙ„Ø§Ø© Ø§Ù„Ø¶Ø­Ù‰', p:20, icon:'ğŸ”†'},
            {id:'quran', n:'Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ', p:50, icon:'ğŸ“–'},
            {id:'azkar', n:'Ø§Ù„Ø£Ø°ÙƒØ§Ø± (Øµ/Ù…)', p:30, icon:'ğŸ“¿'}
        ]
    };

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    function sync() {
        const d = document.getElementById('date-picker').value;
        const dateObj = new Date(d);
        document.getElementById('hijri-display').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(dateObj);
        
        db.ref('osraty/' + d).on('value', snap => render(snap.val() || {}));
        updateAnnualPodium();
    }

    function render(allData) {
        let stats = users.map(u => {
            let score = 0; let uData = allData[u] || {};
            let hasFajrCrown = uData['fajr'] && uData['fajr'].type === 'm';
            
            model.fard.forEach(h => { if(uData[h.id]) score += Number(uData[h.id].p || 0); });
            model.extra.forEach(h => { if(uData[h.id] && uData[h.id].done) score += h.p; });
            return { n: u, s: score, crown: hasFajrCrown };
        });

        drawPodium('daily-podium', [...stats]);
        
        document.getElementById('cards-ui').innerHTML = stats.map(st => `
            <div class="comp-card ${st.n === currentUser ? 'active' : ''}" onclick="selectUser('${st.n}')" style="border:1px solid var(--gold)">
                <b>${st.crown ? '<span class="crown">ğŸ‘‘</span>' : ''}${st.n}</b><br>
                <span style="color:var(--gold); font-weight:bold;">${st.s} Ù†Ù‚Ø·Ø©</span>
            </div>`).join('');
        
        if(currentUser) renderUserForms(allData[currentUser] || {});
    }

    function renderUserForms(userData) {
        document.getElementById('fard-list').innerHTML = model.fard.map(h => {
            const currentType = userData[h.id] ? userData[h.id].type : 'none';
            return `<div class="habit-row">
                <div style="min-width:100px;"><span>${h.icon}</span> <b>${h.n}</b></div>
                <div style="display:flex; gap:4px; flex:1;">
                    <button class="opt-btn ${h.id==='fajr'?'fajr-special':''} ${currentType==='m'?'selected':''}" onclick="saveFard('${h.id}','m',${h.points.m})">
                        <span>Ù…Ø³Ø¬Ø¯</span><small>+${h.points.m}</small>
                    </button>
                    <button class="opt-btn ${currentType==='g'?'selected':''}" onclick="saveFard('${h.id}','g',${h.points.g})">
                        <span>Ø¬Ù…Ø§Ø¹Ø©</span><small>+${h.points.g}</small>
                    </button>
                    <button class="opt-btn ${currentType==='f'?'selected':''}" onclick="saveFard('${h.id}','f',${h.points.f})">
                        <span>ÙØ±Ø¯ÙŠ</span><small>+${h.points.f}</small>
                    </button>
                    <button class="opt-btn ${currentType==='q'?'selected':''}" onclick="saveFard('${h.id}','q',${h.points.q})">
                        <span>Ù‚Ø¶Ø§Ø¡</span><small>+${h.points.q}</small>
                    </button>
                </div>
            </div>`;
        }).join('');

        document.getElementById('extra-list').innerHTML = model.extra.map(h => {
            const done = userData[h.id] ? userData[h.id].done : false;
            return `<div class="habit-row">
                <span>${h.icon} ${h.n}</span>
                <div><span style="color:var(--gold); margin-left:10px;">+${h.p}Ù†</span>
                <input type="checkbox" ${done?'checked':''} onchange="saveExtra('${h.id}', ${h.p}, this.checked)" style="transform:scale(1.5);"></div>
            </div>`;
        }).join('');
    }

    function drawPodium(el, data) {
        const sorted = data.sort((a,b) => b.s - a.s);
        const order = [1, 0, 2, 3]; // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø¹Ø±Ø¶ÙŠØ§Ù‹
        const heights = ['40px', '60px', '30px', '20px'];
        document.getElementById(el).innerHTML = order.map((idx, i) => `
            <div class="podium-step ${idx===0?'p1':''}" style="height:${heights[i]}; width:45px; margin:0 2px;">
                <span style="font-size:0.6rem; color:white; margin-bottom:2px;">${sorted[idx].n}</span>
            </div>`).join('');
    }

    function updateAnnualPodium() {
        db.ref('osraty').once('value', snap => {
            const data = snap.val() || {}; let annual = users.map(u => ({n:u, s:0}));
            Object.values(data).forEach(day => {
                users.forEach((u, i) => { if(day[u]) Object.values(day[u]).forEach(task => annual[i].s += (task.p || 0)); });
            });
            drawPodium('annual-podium', annual);
        });
    }

    function saveFard(id, type, p) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({type, p: Number(p)}); }
    function saveExtra(id, p, done) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({done, p: Number(p)}); }
    function selectUser(u) { currentUser = u; document.getElementById('user-ui').style.display='block'; document.getElementById('current-user-title').innerText="ØªØ³Ø¬ÙŠÙ„: " + u; sync(); }

    window.onload = () => { 
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').onchange = sync;
        sync(); 
    };
</script>
</body>
</html>
