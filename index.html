<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø§Ø¨ Ø±Ù…Ø¶Ø§Ù† 2026 - ØµÙ„Ø§Ù„Ø© & ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --night: #0b132b; --deep-blue: #1c2541; --gold: #fbc02d; --soft-gold: #ffeb3b; --accent: #e67e22; --text: #ecf0f1; }
        body { font-family: 'Amiri', serif; background-color: var(--night); background-image: url('https://www.transparenttextures.com/patterns/stardust.png'); color: var(--text); margin: 0; padding: 10px; }
        .main-container { max-width: 850px; margin: auto; background: rgba(28, 37, 65, 0.95); border: 2px solid var(--gold); border-radius: 25px; padding: 15px; box-shadow: 0 0 20px rgba(251, 192, 45, 0.2); }
        
        /* Ù‡ÙŠØ¯Ø± Ø±Ù…Ø¶Ø§Ù†ÙŠ Ù…ØªØ·ÙˆØ± */
        .header-bar { background: linear-gradient(135deg, #1c2541 0%, #0b132b 100%); color: var(--gold); padding: 20px; border-radius: 20px; border-bottom: 3px solid var(--gold); text-align: center; margin-bottom: 20px; position: relative; overflow: hidden; }
        .header-bar::after { content: 'â­'; position: absolute; top: 10px; left: 20px; font-size: 1.5rem; opacity: 0.5; }
        
        /* Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ù„Ù„Ù…Ø¯ÙŠÙ†ØªÙŠÙ† */
        .timers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .timer-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; border: 1px solid var(--gold); text-align: center; }
        .timer-card h4 { margin: 0; color: var(--soft-gold); font-size: 0.9rem; }
        .timer-val { font-size: 0.85rem; font-weight: bold; color: #fff; }

        /* Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
        .imsakiya-section { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid var(--gold); }
        .imsakiya-table { width: 100%; text-align: center; border-collapse: collapse; font-size: 0.8rem; }
        .imsakiya-table th { color: var(--gold); border-bottom: 1px solid var(--gold); padding: 5px; }
        .imsakiya-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .city-tag { background: var(--gold); color: var(--night); padding: 2px 8px; border-radius: 5px; font-weight: bold; font-size: 0.7rem; }

        .weekly-challenge { background: linear-gradient(45deg, #d35400, #e67e22); color: white; padding: 12px; border-radius: 12px; margin-bottom: 15px; text-align: center; font-weight: bold; box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3); }
        
        /* Ø§Ù„Ø®ØªÙ…Ø© ÙˆØ§Ù„ÙÙˆØ§Ù†ÙŠØ³ */
        .khatma-section { background: rgba(230, 126, 34, 0.1); padding: 15px; border-radius: 15px; border: 1px solid var(--accent); margin-top: 15px; }
        .progress-container { background: #34495e; border-radius: 10px; height: 12px; width: 100%; margin: 10px 0; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, var(--gold), var(--accent)); height: 100%; transition: width 0.5s; }

        .comp-card { background: #1c2541; border: 1px solid var(--gold); border-radius: 15px; padding: 12px; cursor: pointer; text-align: center; transition: 0.3s; }
        .comp-card.active { background: var(--gold); color: var(--night); }
        
        .podium-step { background: var(--gold); color: var(--night); border-radius: 8px 8px 0 0; }
        .chat-area { height: 120px; overflow-y: auto; background: rgba(0,0,0,0.2); border: 1px solid var(--gold); padding: 10px; border-radius: 10px; color: #fff; }
        input, button { border-radius: 8px; border: none; padding: 10px; }
        .opt-btn { background: #34495e; color: white; cursor: pointer; font-size: 0.7rem; }
        .opt-btn.selected { background: var(--gold); color: var(--night); }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-bar">
        <h1 style="margin:0; font-family:'Reem Kufi'; letter-spacing: 2px;">ğŸŒ™ Ù…ÙØ­Ø±Ø§Ø¨Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h1>
        <div id="ramadan-countdown" style="font-size: 0.8rem; margin-top: 5px;"></div>
        <input type="date" id="date-picker" style="margin-top:10px; background: var(--night); color: var(--gold); border: 1px solid var(--gold);">
        <div id="hijri-display" style="margin-top: 5px; font-weight: bold;"></div>
    </div>

    <div class="timers-grid">
        <div class="timer-card">
            <h4>ğŸ‡´ğŸ‡² ØµÙ„Ø§Ù„Ø©</h4>
            <div id="timer-salalah" class="timer-val">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>
        </div>
        <div class="timer-card">
            <h4>ğŸ‡ªğŸ‡¬ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</h4>
            <div id="timer-kafr" class="timer-val">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>
        </div>
    </div>

    <div class="imsakiya-section">
        <h3 style="text-align:center; color:var(--gold); margin-top:0; font-size: 1rem;">ğŸ“… Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„ØµÙ„Ø§Ø© (Ø§Ù„ÙŠÙˆÙ…)</h3>
        <table class="imsakiya-table">
            <thead>
                <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ÙØ¬Ø±</th><th>Ø§Ù„Ø¸Ù‡Ø±</th><th>Ø§Ù„Ø¹ØµØ±</th><th>Ø§Ù„Ù…ØºØ±Ø¨</th><th>Ø§Ù„Ø¹Ø´Ø§Ø¡</th></tr>
            </thead>
            <tbody>
                <tr><td><span class="city-tag">ØµÙ„Ø§Ù„Ø©</span></td><td>05:15</td><td>12:35</td><td>03:55</td><td>06:25</td><td>07:40</td></tr>
                <tr><td><span class="city-tag">ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</span></td><td>05:05</td><td>12:10</td><td>03:15</td><td>05:55</td><td>07:15</td></tr>
            </tbody>
        </table>
    </div>

    <div class="weekly-challenge" id="challenge-text">ğŸ® ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…: ...</div>

    <div class="podiums-wrapper" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <div style="flex:1"><div style="text-align:center; font-size: 0.8rem;">ğŸ† ÙÙˆØ§Ù†ÙŠØ³ Ø§Ù„ÙŠÙˆÙ…</div><div id="daily-podium" style="display:flex; align-items:flex-end; height:80px; border-bottom:2px solid var(--gold);"></div></div>
        <div style="flex:1"><div style="text-align:center; font-size: 0.8rem;">ğŸŒŸ ÙÙˆØ§Ù†ÙŠØ³ Ø§Ù„Ø¹Ø§Ù…</div><div id="annual-podium" style="display:flex; align-items:flex-end; height:80px; border-bottom:2px solid var(--gold);"></div></div>
    </div>

    <div class="competitors-grid" id="cards-ui" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>

    <div id="user-ui" style="display:none; margin-top:20px;">
        <hr style="border: 0; border-top: 1px solid var(--gold); margin: 20px 0;">
        <h2 id="current-user-title" style="text-align:center; color:var(--gold);"></h2>
        
        <div class="section-card khatma-section">
            <h3 style="margin-top:0">ğŸ“– Ø®ØªÙ…Ø© Ø±Ù…Ø¶Ø§Ù†</h3>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>ÙˆØµÙ„Øª Ù„Ù„Ø¬Ø²Ø¡:</span>
                <input type="number" id="quran-part" min="0" max="30" onchange="saveKhatma(this.value)" style="width:60px; text-align:center;">
            </div>
            <div class="progress-container"><div id="khatma-progress" class="progress-bar" style="width: 0%"></div></div>
            <small id="khatma-percent" style="color:var(--gold)">0%</small>
        </div>

        <div class="section-card" style="background: rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-top:15px;">
            <h3>ğŸ•‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª</h3>
            <div id="fard-list"></div>
            <div id="extra-list" style="margin-top:10px;"></div>
        </div>
        
        <div class="section-card" style="margin-top:15px;">
            <h3>ğŸ’¬ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h3>
            <div id="chat-box" class="chat-area"></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="chat-in" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." style="flex:1;">
                <button onclick="sendMsg()" style="background:var(--gold); color:var(--night); font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDBa3kZK5ibQEIRRjVIHL7JIOHixX_7rVs", authDomain: "ebada-656e1.firebaseapp.com", databaseURL: "https://ebada-656e1-default-rtdb.firebaseio.com", projectId: "ebada-656e1", storageBucket: "ebada-656e1.firebasestorage.app", messagingSenderId: "705608653939", appId: "1:705608653939:web:5ab3609a6f7ccc8675de06" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();
    let currentUser = null; const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];
    
    const challenges = ["Ø¥ÙØ·Ø§Ø± ØµØ§Ø¦Ù… Ø§Ù„ÙŠÙˆÙ…", "Ù‚Ø±Ø§Ø¡Ø© Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…", "ØµÙ„Ø© Ø±Ø­Ù… Ø¨Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„ØªØ¨ÙƒÙŠØ± Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­"];

    const model = {
        fard: [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±'}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±'}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±'}, {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨'}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡'}],
        extra: [{id:'traweeh', n:'Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­', p:60}, {id:'duha', n:'Ø§Ù„Ø¶Ø­Ù‰', p:15}, {id:'azkar', n:'Ø§Ù„Ø£Ø°ÙƒØ§Ø±', p:20}]
    };

    function sync() {
        const d = document.getElementById('date-picker').value;
        const hijri = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(new Date(d));
        document.getElementById('hijri-display').innerText = hijri;
        document.getElementById('challenge-text').innerText = "ğŸ® ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…: " + challenges[new Date(d).getDate() % challenges.length];

        db.ref('osraty/' + d).on('value', snap => render(snap.val() || {}));
        db.ref('chat/' + d).on('value', snap => {
            const m = snap.val() || [];
            document.getElementById('chat-box').innerHTML = m.map(x => `<div><b style="color:var(--gold)">${x.u}:</b> ${x.t}</div>`).join('');
            document.getElementById('chat-box').scrollTop = 9999;
        });
        updateGlobalPodium();
    }

    function updateTimers() {
        const now = new Date();
        // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØºØ±Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ÙŠÙˆÙ… (ØµÙ„Ø§Ù„Ø© 18:25 ØŒ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ® 17:55)
        const salalahIftar = new Date(); salalahIftar.setHours(18, 25, 0);
        const kafrIftar = new Date(); kafrIftar.setHours(17, 55, 0);

        [ {id: 'timer-salalah', time: salalahIftar}, {id: 'timer-kafr', time: kafrIftar} ].forEach(city => {
            const diff = city.time - now;
            if(diff > 0) {
                const h = Math.floor(diff/3600000); const m = Math.floor((diff%3600000)/60000);
                document.getElementById(city.id).innerText = `Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ù…ØºØ±Ø¨: ${h}Ø³ ${m}Ø¯`;
            } else {
                document.getElementById(city.id).innerText = "ğŸ•Œ Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø¥ÙØ·Ø§Ø±";
                document.getElementById(city.id).style.color = "var(--gold)";
            }
        });
        
        // Ø¹Ø¯Ø§Ø¯ Ø±Ù…Ø¶Ø§Ù† (18 ÙØ¨Ø±Ø§ÙŠØ± 2026)
        const ramadan = new Date("2026-02-18");
        const rDiff = ramadan - now;
        if(rDiff > 0) document.getElementById('ramadan-countdown').innerText = `âœ¨ Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø±Ù…Ø¶Ø§Ù†: ${Math.floor(rDiff/(1000*60*60*24))} ÙŠÙˆÙ… âœ¨`;
    }

    function render(allData) {
        let stats = users.map(u => {
            let score = 0; let uData = allData[u] || {};
            model.fard.forEach(h => { if(uData[h.id]?.p) score += Number(uData[h.id].p); });
            model.extra.forEach(h => { if(uData[h.id]?.done) score += h.p; });
            return { n: u, s: score };
        });

        document.getElementById('cards-ui').innerHTML = stats.map(st => `
            <div class="comp-card ${st.n === currentUser ? 'active' : ''}" onclick="selectUser('${st.n}')">
                <b>${st.n}</b><br><span style="font-size:1.1rem">${st.s}</span> ğŸ®
            </div>`).join('');

        if(currentUser) {
            const part = allData[currentUser]?.khatma || 0;
            document.getElementById('quran-part').value = part;
            document.getElementById('khatma-progress').style.width = (part/30*100) + "%";
            document.getElementById('khatma-percent').innerText = Math.round(part/30*100) + "% Ù…Ù† Ø§Ù„Ø®ØªÙ…Ø©";
            renderUserForms(allData[currentUser] || {});
        }
        drawPodium('daily-podium', stats);
    }

    function renderUserForms(uData) {
        document.getElementById('fard-list').innerHTML = model.fard.map(h => {
            const v = uData[h.id]?.type || 'none';
            return `<div class="habit-row"><span>${h.n}</span><div>
                <button class="opt-btn ${v==='m'?'selected':''}" onclick="saveFard('${h.id}','m',50)">Ø¬Ù…Ø§Ø¹Ø©</button>
                <button class="opt-btn ${v==='f'?'selected':''}" onclick="saveFard('${h.id}','f',25)">ÙØ±Ø¯ÙŠ</button>
            </div></div>`;
        }).join('');
        document.getElementById('extra-list').innerHTML = model.extra.map(h => {
            return `<div class="habit-row"><span>${h.n}</span><input type="checkbox" ${uData[h.id]?.done?'checked':''} onchange="saveExtra('${h.id}',${h.p},this.checked)"></div>`;
        }).join('');
    }

    function drawPodium(id, data) {
        const sorted = [...data].sort((a,b)=>b.s-a.s);
        document.getElementById(id).innerHTML = [1,0,2].map(i => sorted[i] ? `
            <div class="podium-step" style="flex:1; height:${[50,100,30][i]}%; margin:0 2px; text-align:center; font-size:0.6rem;">
                ${sorted[i].n}<br>${sorted[i].s}
            </div>` : '').join('');
    }

    function saveKhatma(v) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/khatma`).set(Number(v)); }
    function saveFard(id,t,p) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({type:t, p:Number(p)}); }
    function saveExtra(id,p,d) { db.ref(`osraty/${document.getElementById('date-picker').value}/${currentUser}/${id}`).set({done:d, p:d?p:0}); }
    function selectUser(u) { currentUser = u; document.getElementById('user-ui').style.display='block'; document.getElementById('current-user-title').innerText = "Ø£Ù‡Ù„Ø§Ù‹ " + u; sync(); }
    function sendMsg() { const i = document.getElementById('chat-in'); if(!i.value) return; db.ref('chat/'+document.getElementById('date-picker').value).once('value', s=>{ let m=s.val()||[]; m.push({u:currentUser, t:i.value}); db.ref('chat/'+document.getElementById('date-picker').value).set(m); i.value=""; }); }

    function updateGlobalPodium() {
        db.ref('osraty').once('value', snap => {
            const data = snap.val() || {}; let total = users.map(u=>({n:u, s:0}));
            Object.values(data).forEach(day => {
                users.forEach((u, i) => {
                    const uD = day[u]; if(!uD) return;
                    model.fard.forEach(f => total[i].s += (uD[f.id]?.p || 0));
                    model.extra.forEach(e => total[i].s += (uD[e.id]?.done ? e.p : 0));
                });
            });
            drawPodium('annual-podium', total);
        });
    }

    window.onload = () => {
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        sync(); setInterval(updateTimers, 1000); updateTimers();
    };
</script>
</body>
</html>
